<main class="tps-list">
<section class="table-header">
    <div class="table-search">
        <mat-form-field style="width: 100px" subscriptSizing="dynamic">
            <mat-label>
              <mat-icon aria-hidden="false" aria-label="Search icon">search</mat-icon>
              Cari
            </mat-label>
            <input type="number" placeholder="No. TPS" matInput style="width: 80px"
                   min="1" max="999" [value]="tpsNo"
                   (input)="changeTpsNo($event)" #firstInput>
        </mat-form-field>
    </div>
    <div class="table-filter">
        <mat-checkbox [(ngModel)]="service.isPendingTps" (change)="updateTpsList()">Pending</mat-checkbox>
        <mat-checkbox [(ngModel)]="service.isErrorTps" (change)="updateTpsList()">Error</mat-checkbox>
        <mat-checkbox [(ngModel)]="service.isCompleteTps" (change)="updateTpsList()">Complete</mat-checkbox>
    </div>
</section>

<section class="tps-result">
    @for (c of tpsList; track c.id) {
        @defer (on viewport) {
            <div class="tps-item" *ngIf="c.agg[0] as a">
                <td class="tps" nowrap valign="top"
                    [class]="
                        a.totalPendingTps ? 'pending' :
                        a.totalJagaTps ? 'jaga' : ''">
                    <span class="tps-number">
                        @if (lokasi.id.startsWith('99')) {
                            {{ lokasi.parents[lokasi.parents.length - 1][1] }}
                        } @else {
                            TPS<br>
                        }
                        #{{ a.name }}
                    </span>
                    <span class="tps-result">
                        Pas1: <b>{{ a.pas1 }}</b><br>
                        Pas2: <b>{{ a.pas2 }}</b><br>
                        Pas3: <b>{{ a.pas3 }}</b>
                    </span>
                    <span class="tps-dpt">
                        @if (a.dpt && a.dpt > 0) {
                            DPT: <b>{{ a.dpt }}</b>
                        }
                    </span>
                    @if (a.totalErrorTps) {
                        <span class="error">Error!</span>
                    }
                    @if (a.totalJagaTps) {
                        <span class="jaga">Terjaga</span>
                    }
                    @if (a.totalLaporTps) {
                        <span class="lapor">{{a.totalLaporTps}}<br>Laporan</span>
                    }
                </td>
                <td class="foto" align="left">
                    <app-tps-row [c]="c"
                        [tpsId]="lokasi.id + c.id"
                        [userProfile]="userProfile">
                    </app-tps-row>
                </td>
            </div>
        } @placeholder {
            <br>
        }
    } @empty {
        <br><br>
        <ul>
            @if (firstInput.value) {
                <li>Tidak ada TPS dengan nomor TPS = {{ firstInput.value }}</li>
            }
            @if (service.isPendingTps) {
                <li>Tidak ada TPS dengan status Pending</li>
            }
            @if (service.isErrorTps) {
                <li>Tidak ada TPS dengan status Error.</li>
            }
            @if (service.isCompleteTps) {
                <li>Tidak ada TPS dengan status Complete.</li>
            }
        </ul>
    }
</section>
</main>
