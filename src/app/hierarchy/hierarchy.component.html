<div *ngIf="lokasi$ | async as lokasi">

<header class="sticky-header">
  <nav aria-label="Breadcrumb" class="breadcrumb">
      <ul class="breadcrumb-list">
          @for (p of lokasi.parents; track p[0];) {
              <li class="breadcrumb-item">
                  <a class="breadcrumb-link" [routerLink]="['/h', p[0]]" routerLinkActive="active">{{ p[1] }}</a>
              </li>
          }
      </ul>
  </nav>
  <button class="refresh" mat-icon-button color="primary" (click)="reloadLokasi()"
      [disabled]="service.rpcIsRunning">
      @if (service.rpcIsRunning) {
          <mat-spinner [diameter]="25"></mat-spinner>
      } @else {
          <mat-icon>refresh</mat-icon>
      }
  </button>
</header>

@if (lokasi.id.length === 10) {
    <!-- Level TPS -->
    <app-tps-list
        [tpsNo]="tpsNo"
        [userProfile]="userProfile"
        [lokasi]="lokasi">
    </app-tps-list>
} @else {
    <!-- Level Provinsi, Kecamatan, Kelurahan -->
    <table class="collapsed_border sticky_table">
    <thead>
        <tr>
            <th class="lokasi">{{ lokasi.level }}</th>
            <th class="paslon">1</th>
            <th class="paslon">2</th>
            <th class="paslon">3</th>
            <th class="cov"></th>
        </tr>
    </thead>
    <tbody class="data">
        @for (c of lokasi.children; track c.id;) {
        <tr *ngIf="c.agg[0] as a" height="56">
            <td><div class="lokasi">
                <a class="hierarchy" [routerLink]="['/h', c.id]">{{ a.name }}</a>
                <a class="hierarchy" *ngIf="a.totalPendingTps as p" [routerLink]="['/h', a.anyPendingTps]">
                    <b style="color: orange"> ({{ p }})</b>
                </a>
                <a class="hierarchy" *ngIf="a.totalErrorTps as e" [routerLink]="['/h', a.anyErrorTps]">
                    <b style="color: red"> ({{ e }})</b>
                </a>
            </div></td>
            @if (a.pas1 + a.pas2 + a.pas3; as totalVotes) {
                <td align="center">
                    <app-percent [nom]="a.pas1" [den]="totalVotes" [showDen]="false"></app-percent>
                </td>
                <td align="center">
                    <app-percent [nom]="a.pas2" [den]="totalVotes" [showDen]="false"></app-percent>
                </td>
                <td align="center">
                    <app-percent [nom]="a.pas3" [den]="totalVotes" [showDen]="false"></app-percent>
                </td>
            } @else {
                <td align="center">-</td>
                <td align="center">-</td>
                <td align="center">-</td>
            }
            <td nowrap align="center">
                <app-percent [nom]="a.totalCompletedTps" [den]="a.totalTps"></app-percent>
            </td>
        </tr>
        }
    </tbody>
    <tfoot class="sum">
        <tr height="56">
            <th align="center">
                TOTAL
                <b *ngIf="lokasi.total.totalPendingTps as p" style="color: orange"> ({{ p }})</b>
                <b *ngIf="lokasi.total.totalErrorTps as e" style="color: red"> ({{ e }})</b>
            </th>
            @if (lokasi.total.pas1 + lokasi.total.pas2 + lokasi.total.pas3; as totalVotes) {
                <th align="center">
                    <app-percent [nom]="lokasi.total.pas1" [den]="totalVotes" [showDen]="false"></app-percent>
                </th>
                <th align="center">
                    <app-percent [nom]="lokasi.total.pas2" [den]="totalVotes" [showDen]="false"></app-percent>
                </th>
                <th align="center">
                    <app-percent [nom]="lokasi.total.pas3" [den]="totalVotes" [showDen]="false"></app-percent>
                </th>
            } @else {
                <th align="center">-</th>
                <th align="center">-</th>
                <th align="center">-</th>
            }
            <th>
                <app-percent [nom]="lokasi.total.totalCompletedTps" [den]="lokasi.total.totalTps"></app-percent>
            </th>
        </tr>
    </tfoot>
    </table>
}
</div>
